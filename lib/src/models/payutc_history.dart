import 'package:flutter/cupertino.dart';
import 'package:payutc/generated/l10n.dart';

/// credit : 820
/// historique : [{"amount":10,"date":"2022-09-15T10:45:39","firstname":"Loic","fun":null,"id":170900,"image_id":null,"invoice":null,"lastname":"JUMEL","name":"Je test l'api de transfert","quantity":1,"removed":false,"type":"VIROUT"},{"amount":180,"date":"2022-09-12T21:15:13","firstname":"Loic","fun":null,"id":170689,"image_id":null,"invoice":null,"lastname":"JUMEL","name":"Pour le lundi bis","quantity":1,"removed":false,"type":"VIROUT"},{"amount":360,"date":"2022-09-12T20:54:02","firstname":"Loic","fun":null,"id":170687,"image_id":null,"invoice":null,"lastname":"JUMEL","name":"Pour le lundi","quantity":1,"removed":false,"type":"VIROUT"},{"amount":180,"date":"2022-09-08T20:03:54","firstname":null,"fun":"Picasso","id":3051644,"image_url":"https://nemopay.imgix.net/private/f335c957-8d3a-4cb1-b16f-7456ec0328b0.jpg","invoice":null,"lastname":null,"name":"Kasteel Rouge","product_id":14821,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":65,"date":"2022-09-08T15:16:27","firstname":null,"fun":"Picasso","id":3050783,"image_url":"https://nemopay.imgix.net/private/7670d487-970b-4c20-a231-83d9e0765722.jpg","invoice":null,"lastname":null,"name":"Sprite","product_id":16475,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":175,"date":"2022-09-07T21:20:42","firstname":null,"fun":"Picasso","id":3050010,"image_url":"https://nemopay.imgix.net/private/aabbf336-e8e0-4126-b71d-aeeb37159a39.jpg","invoice":null,"lastname":null,"name":"Cuvée des Trolls","product_id":457,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":180,"date":"2022-09-06T20:37:05","firstname":null,"fun":"Picasso","id":3048013,"image_url":"https://nemopay.imgix.net/private/f335c957-8d3a-4cb1-b16f-7456ec0328b0.jpg","invoice":null,"lastname":null,"name":"Kasteel Rouge","product_id":14821,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":180,"date":"2022-09-06T19:50:54","firstname":null,"fun":"Picasso","id":3047398,"image_url":"https://nemopay.imgix.net/private/f335c957-8d3a-4cb1-b16f-7456ec0328b0.jpg","invoice":null,"lastname":null,"name":"Kasteel Rouge","product_id":14821,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":180,"date":"2022-09-06T18:59:22","firstname":null,"fun":"Picasso","id":3046865,"image_url":"https://nemopay.imgix.net/private/f335c957-8d3a-4cb1-b16f-7456ec0328b0.jpg","invoice":null,"lastname":null,"name":"Kasteel Rouge","product_id":14821,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":180,"date":"2022-09-06T18:55:32","firstname":null,"fun":"Picasso","id":3046830,"image_url":"https://nemopay.imgix.net/private/f335c957-8d3a-4cb1-b16f-7456ec0328b0.jpg","invoice":null,"lastname":null,"name":"Kasteel Rouge","product_id":14821,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":200,"date":"2022-09-06T10:20:10","firstname":null,"fun":"ALESC","id":3046374,"image_url":null,"invoice":null,"lastname":null,"name":"Machine a laver Ruche n°2","product_id":2116,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":-100,"date":"2022-09-05T23:59:57","firstname":null,"fun":"Intégration","id":3046112,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":-1.0,"removed":false,"type":"PURCHASE"},{"amount":260,"date":"2022-09-05T23:48:06","firstname":null,"fun":"Intégration","id":3045990,"image_url":"https://nemopay.imgix.net/private/7f1c4064-dd1c-4c0f-98fc-4b596b1e283f.png","invoice":null,"lastname":null,"name":"Kriek","product_id":17820,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":100,"date":"2022-09-05T23:48:06","firstname":null,"fun":"Intégration","id":3045989,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":-200,"date":"2022-09-05T23:14:58","firstname":null,"fun":"Intégration","id":3045391,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":-2.0,"removed":false,"type":"PURCHASE"},{"amount":250,"date":"2022-09-05T22:34:36","firstname":null,"fun":"Intégration","id":3044483,"image_url":"https://nemopay.imgix.net/private/e900a378-f09a-456f-8b57-e914ca5198b0.png","invoice":null,"lastname":null,"name":"Session IPA","product_id":17840,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":100,"date":"2022-09-05T22:34:36","firstname":null,"fun":"Intégration","id":3044482,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":-100,"date":"2022-09-05T22:14:50","firstname":null,"fun":"Intégration","id":3043973,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":-1.0,"removed":false,"type":"PURCHASE"},{"amount":260,"date":"2022-09-05T21:56:53","firstname":null,"fun":"Intégration","id":3043457,"image_url":"https://nemopay.imgix.net/private/7f1c4064-dd1c-4c0f-98fc-4b596b1e283f.png","invoice":null,"lastname":null,"name":"Kriek","product_id":17820,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":100,"date":"2022-09-05T21:56:53","firstname":null,"fun":"Intégration","id":3043456,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":-100,"date":"2022-09-05T21:30:32","firstname":null,"fun":"Intégration","id":3042433,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":-1.0,"removed":false,"type":"PURCHASE"},{"amount":260,"date":"2022-09-05T21:03:41","firstname":null,"fun":"Intégration","id":3041721,"image_url":"https://nemopay.imgix.net/private/7f1c4064-dd1c-4c0f-98fc-4b596b1e283f.png","invoice":null,"lastname":null,"name":"Kriek","product_id":17820,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":100,"date":"2022-09-05T21:03:41","firstname":null,"fun":"Intégration","id":3041720,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":-100,"date":"2022-09-01T23:06:05","firstname":null,"fun":"Intégration","id":3038535,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":-1.0,"removed":false,"type":"PURCHASE"},{"amount":280,"date":"2022-09-01T22:41:18","firstname":null,"fun":"Intégration","id":3038325,"image_url":"https://nemopay.imgix.net/private/3d895947-427b-4ff7-b6ee-f480544dada0.jpeg?mark=%2Fpublic%2FCoins%2FLettres%2FB.png","invoice":null,"lastname":null,"name":"Bière blonde Diole","product_id":17832,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":100,"date":"2022-09-01T22:41:18","firstname":null,"fun":"Intégration","id":3038324,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":100,"date":"2022-09-01T22:40:58","firstname":"","fun":null,"id":169778,"image_id":null,"invoice":null,"lastname":"","name":"cesar","quantity":1,"removed":false,"type":"VIRIN"},{"amount":-100,"date":"2022-09-01T21:45:24","firstname":null,"fun":"Intégration","id":3037436,"image_url":"https://nemopay.imgix.net/public/Bar/Consigne/Gobelet.jpg","invoice":null,"lastname":null,"name":"Ecocup","product_id":15127,"quantity":-1.0,"removed":false,"type":"PURCHASE"},{"amount":280,"date":"2022-09-01T20:48:46","firstname":null,"fun":"Intégration","id":3036380,"image_url":"https://nemopay.imgix.net/private/3d895947-427b-4ff7-b6ee-f480544dada0.jpeg?mark=%2Fpublic%2FCoins%2FLettres%2FB.png","invoice":null,"lastname":null,"name":"Bière blonde Diole","product_id":17832,"quantity":1.0,"removed":false,"type":"PURCHASE"},{"amount":4000,"date":"2022-09-01T19:39:15","firstname":null,"fun":null,"id":897026,"image_id":null,"invoice":null,"lastname":null,"name":null,"quantity":1,"removed":false,"type":"RECHARGE"}]

class PayUtcHistory {
  PayUtcHistory({
    this.credit,
    this.historique,
  });

  PayUtcHistory.fromJson(dynamic json) {
    credit = json['credit'];
    if (json['historique'] != null) {
      historique = [];
      json['historique'].forEach((v) {
        historique?.add(PayUtcItem.fromJson(v));
      });
    }
  }

  num? credit;
  List<PayUtcItem>? historique;
}

/// amount : 10
/// date : "2022-09-15T10:45:39"
/// firstname : "Loic"
/// fun : null
/// id : 170900
/// image_id : null
/// invoice : null
/// lastname : "JUMEL"
/// name : "Je test l'api de transfert"
/// quantity : 1
/// removed : false
/// type : "VIROUT"

class PayUtcItem {
  PayUtcItem({
    this.amount,
    DateTime? date,
    this.firstname,
    this.fun,
    this.id,
    this.imageId,
    this.invoice,
    this.lastname,
    this.name,
    this.quantity = 1,
    this.removed,
    this.type = 'PURCHASE',
    this.imageUrl,
    this.productId,
  }) : date = date ?? DateTime.now();

  PayUtcItem.fromJson(dynamic json) {
    amount = json['amount'];
    date = DateTime.parse(json['date'] ?? "");
    firstname = json['firstname'];
    fun = json['fun'];
    id = json['id'];
    imageId = json['image_id'];
    invoice = json['invoice'];
    lastname = json['lastname'];
    name = json['name'];
    quantity = json['quantity'];
    removed = json['removed'];
    type = json['type'];
    productId = json['product_id'];
    imageUrl = json['image_url'];
  }

  num? amount;
  late DateTime date;
  String? firstname;
  String? fun;
  num? id;
  dynamic imageId;
  dynamic invoice;
  String? lastname;
  String? name;
  num quantity = 1;
  bool? removed;
  late String type;
  num? productId;
  String? imageUrl;

  //copy with
  PayUtcItem copyWith({
    num? amount,
    DateTime? date,
    String? firstname,
    String? fun,
    num? id,
    dynamic imageId,
    dynamic invoice,
    String? lastname,
    String? name,
    num? quantity,
    bool? removed,
    String? type,
    num? productId,
    String? imageUrl,
  }) {
    return PayUtcItem(
      amount: amount ?? this.amount,
      date: date ?? this.date,
      firstname: firstname ?? this.firstname,
      fun: fun ?? this.fun,
      id: id ?? this.id,
      imageId: imageId ?? this.imageId,
      invoice: invoice ?? this.invoice,
      lastname: lastname ?? this.lastname,
      name: name ?? this.name,
      quantity: quantity ?? this.quantity,
      removed: removed ?? this.removed,
      type: type ?? this.type,
      productId: productId ?? this.productId,
      imageUrl: imageUrl ?? this.imageUrl,
    );
  }

  bool get isProduct => productId != null;

  bool get isOutAmount {
    //Consigne éco-cup
    if (type == "PURCHASE" && quantity.isNegative) return false;
    //Si achat ou virement
    if (type == "PURCHASE" || type == "VIROUT") return true;
    return false;
  }

  bool get isInAmount => !isOutAmount;

  bool get isVirement => type == "VIRIN" || type == "VIROUT";

  bool get isPurchase => type == "PURCHASE";

  bool get isReload => type == "RECHARGE";

  double get amountParse {
    double am = amount?.toDouble() ?? 0;
    return am.abs() / 100;
  }

  String service(BuildContext context) {
    if (type == "RECHARGE") return Translate.of(context).yourCard;
    if (isVirement) {
      return name ?? "$firstname $lastname";
    }
    return fun ?? name ?? "";
  }

  String nameExtracted(BuildContext context) {
    if (isVirement) {
      return "${Translate.of(context).transfertPayutc}${"(${"$firstname ${(lastname?.isNotEmpty ?? false) ? lastname?.substring(0, 1) : ""}."})"}";
    }
    if (type == "RECHARGE") return Translate.of(context).reloading;
    return "${quantity.abs().toInt()} $name";
  }

  bool isAtSameDay(PayUtcItem other) {
    return other.date.year == date.year &&
        other.date.day == date.day &&
        other.date.month == date.month;
  }

  String get userVirName =>
      "$firstname ${(lastname?.isNotEmpty ?? false) ? lastname?.substring(0, 1) : ""}.";
}
